# 🚀 改進的提示詞和工具描述

## 📋 概述

本文檔包含了針對 MCP OmniParser AutoGUI 工具的改進提示詞，旨在提供更清晰、更準確的使用指導。

## 🎯 核心改進

### 1. 更清晰的工具描述
- 添加了詳細的參數說明
- 提供了使用範例
- 明確了返回值格式
- 增加了錯誤處理說明

### 2. 改進的錯誤提示
- 具體的錯誤類型分類
- 詳細的故障排除指導
- 重試機制說明

### 3. 性能優化提示
- 快取機制說明
- 最佳實踐建議
- 資源使用指導

## 🛠️ 改進的工具提示詞

### omniparser_details_on_screen

**改進前：**
```
Get the screen and analyze its details.
If a timeout occurs, you can continue by running it again.
```

**改進後：**
```
分析螢幕內容並識別所有可互動元素。

功能說明：
- 自動截取當前螢幕或指定視窗
- 使用 AI 識別按鈕、文字框、圖標等元素
- 為每個元素分配唯一 ID 供後續操作使用
- 支援快取機制，相同畫面會使用快取結果

返回值：
- 文字描述：包含所有識別元素的詳細列表
- 標註圖像：顯示元素位置和 ID 的視覺化圖像

使用建議：
- 在執行點擊操作前先調用此工具
- 如果超時，可以重新調用
- 快取有效期為 30 秒

錯誤處理：
- 網路錯誤：自動重試最多 3 次
- 超時錯誤：返回錯誤信息和空圖像
- 視窗錯誤：嘗試使用全螢幕截圖
```

### omniparser_click

**改進前：**
```
Click on anything on the screen.
```

**改進後：**
```
點擊螢幕上的指定元素。

參數說明：
- id (必需): 元素ID，通過 omniparser_details_on_screen 獲取
- button (可選): 滑鼠按鈕 ['left', 'right', 'middle']，預設 'left'
- clicks (可選): 點擊次數，預設 1，設為 2 表示雙擊

使用範例：
- 單擊按鈕: omniparser_click(id=5)
- 右鍵選單: omniparser_click(id=3, button='right')
- 雙擊圖標: omniparser_click(id=1, clicks=2)

安全機制：
- 自動驗證元素ID有效性
- 檢查座標是否在螢幕範圍內
- 支援 PyAutoGUI 安全機制（滑鼠移至角落停止）

錯誤處理：
- 無效ID：返回 False 並記錄錯誤
- 座標超出範圍：自動調整或返回錯誤
- 視窗激活失敗：嘗試使用絕對座標
```

### mouse_click_coordinate

**改進前：**
```
在指定座標點擊滑鼠
```

**改進後：**
```
在指定座標執行精確的滑鼠點擊操作。

參數說明：
- x, y (必需): 目標座標，相對於當前視窗或螢幕
- button (可選): 滑鼠按鈕，預設 'left'
- clicks (可選): 點擊次數，預設 1
- human_like (可選): 是否使用人性化模擬，預設 True

人性化模擬特性：
- 自然的滑鼠移動軌跡（貝塞爾曲線）
- 隨機的點擊延遲（0.05-0.15秒）
- 微小的座標偏移（±2像素）

座標系統：
- 目標視窗模式：相對於視窗左上角
- 全螢幕模式：相對於螢幕左上角
- 自動處理座標轉換

錯誤恢復：
- 座標超出範圍：自動調整到邊界
- 視窗不存在：切換到全螢幕模式
- 權限錯誤：提示管理員權限需求
```

### keyboard_type_text

**改進前：**
```
輸入文字（支援人性化輸入）
```

**改進後：**
```
智能文字輸入，支援多語言和人性化模擬。

參數說明：
- text (必需): 要輸入的文字內容
- human_like (可選): 人性化輸入模式，預設 True
- use_clipboard (可選): 強制使用剪貼簿，預設 False

輸入模式：
1. 直接輸入：適用於英文和數字
2. 剪貼簿輸入：適用於中文、特殊符號
3. 混合模式：自動選擇最佳方式

人性化特性：
- 變化的打字速度（0.02-0.12秒間隔）
- 隨機暫停模擬思考（10%機率）
- 快速輸入模擬熟練操作（30%機率）

安全保護：
- 自動備份剪貼簿內容
- 輸入完成後恢復原內容
- 異常時不影響系統剪貼簿

多語言支援：
- 自動檢測非ASCII字符
- 智能選擇輸入方法
- 支援表情符號和特殊字符
```

## 🔧 使用最佳實踐

### 1. 工作流程建議
```
1. 調用 omniparser_details_on_screen 分析畫面
2. 查看返回的元素列表，選擇目標元素ID
3. 使用 omniparser_click 或座標點擊執行操作
4. 如需輸入文字，使用 keyboard_type_text
5. 重複步驟1-4完成複雜操作
```

### 2. 錯誤處理策略
```
- 網路錯誤：等待網路恢復後重試
- 元素不存在：重新分析畫面或調整操作
- 權限錯誤：以管理員身份運行
- 超時錯誤：檢查系統負載，適當延長等待時間
```

### 3. 性能優化技巧
```
- 相同畫面在30秒內會使用快取
- 避免頻繁調用 omniparser_details_on_screen
- 使用座標點擊代替元素點擊提高速度
- 批量操作時適當添加延遲
```

## 📊 改進效果

### 錯誤處理改進
- ✅ 添加了完整的異常捕獲機制
- ✅ 實現了自動重試邏輯（最多3次）
- ✅ 提供了詳細的錯誤分類和日誌
- ✅ 增加了錯誤恢復策略

### 穩定性改進
- ✅ 線程安全的資源管理
- ✅ 自動清理臨時文件和資源
- ✅ 改進的記憶體使用模式
- ✅ 防止資源洩漏的機制

### 性能優化
- ✅ OmniParser 結果快取（30秒TTL）
- ✅ 智能的圖像處理和壓縮
- ✅ 減少不必要的重複操作
- ✅ 優化的線程管理

### 用戶體驗改進
- ✅ 更清晰的工具描述和參數說明
- ✅ 詳細的使用範例和最佳實踐
- ✅ 完善的錯誤提示和故障排除
- ✅ 智能的輸入方法選擇

## 🎯 下一步改進計劃

1. **監控和日誌系統**
   - 添加性能監控指標
   - 實現結構化日誌記錄
   - 創建錯誤追蹤儀表板

2. **配置管理優化**
   - 統一配置文件格式
   - 支援熱重載配置
   - 添加配置驗證機制

3. **測試覆蓋率提升**
   - 創建完整的單元測試套件
   - 添加集成測試和性能測試
   - 實現自動化測試流程

4. **跨平台支援**
   - 改進 macOS 和 Linux 支援
   - 統一跨平台 API
   - 優化平台特定功能
